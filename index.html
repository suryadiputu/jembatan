<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>WebGIS Jembatan</title>

<link rel="stylesheet"
href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<link rel="stylesheet"
href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>

<link rel="stylesheet"
href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<style>

html,body{
height:100%;
margin:0;
font-family:Arial;
}

#map{
height:100%;
}

/* PANEL */

.panel{

position:absolute;

top:10px;

left:50%;

transform:translateX(-50%);

background:white;

padding:15px;

border-radius:14px;

box-shadow:0 4px 12px rgba(0,0,0,0.3);

z-index:1000;

width:300px;

}

/* DROPDOWN */

select{

width:100%;

padding:10px;

font-size:16px;

border-radius:8px;

margin-bottom:8px;

}

/* BUTTON */

button{

width:100%;

padding:12px;

font-size:16px;

border-radius:8px;

border:none;

margin-top:6px;

cursor:pointer;

}

/* GO */

.go{

background:#2b6df6;

color:white;

}

/* POSISI */

.posisi{

background:#1e8e3e;

color:white;

}

/* GMAPS */

.gmaps-btn{

display:inline-block;

padding:8px 14px;

background:#0d6efd;

color:#fff !important;

text-decoration:none;

border-radius:6px;

font-size:13px;

margin-top:8px;

}

</style>

</head>

<body>

<div id="map"></div>

<div class="panel">

<select id="pilih">

<option value="">Pilih Jembatan</option>

</select>

<button class="go" onclick="zoomJembatan()">
GO
</button>

<button class="posisi" onclick="posisiSaya()">
Posisi Saat Ini
</button>

</div>


<script>


var map=L.map('map').setView([-8.4,115.2],9);


L.tileLayer(

'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'

).addTo(map);



var cluster=L.markerClusterGroup();


map.addLayer(cluster);



var dataJembatan=[];



/* ICON */

var bridgeIcon=L.icon({

iconUrl:'bridge.png',

iconSize:[34,34],

iconAnchor:[17,34]

});



/* LOAD EXCEL */

fetch('./Data Jembatan.xlsx')

.then(res=>res.arrayBuffer())

.then(data=>{

var workbook=XLSX.read(data);

var sheet=workbook.Sheets[workbook.SheetNames[0]];

var json=XLSX.utils.sheet_to_json(sheet);



json.forEach(function(row,i){



var lat=row.Latitude;

var lng=row.Longitude;



if(!lat || !lng)return;



dataJembatan.push(row);



/* MARKER */

var marker=L.marker(

[lat,lng],

{icon:bridgeIcon}

);



/* POPUP */

var popup=`

<b>${row["Nama Jembatan"]}</b><br><br>

No. Jbt : ${row["No. Jbt"]}<br>

Tahun Bangun : ${row["Tahun Bangun"]}<br>

Panjang (m) : ${row["Panjang (m)"]}<br>

Lebar Jembatan (m) : ${row["Lebar Jembatan (m)"]}<br>

Lebar Lajur Lalin (m) : ${row["Lebar Lajur Lalin (m)"]}<br>

Jml Bentang : ${row["Jml Bentang"]}<br>

Tipe Bang. Atas : ${row["Tipe Bang. Atas"]}<br>

NK S2 2025 : ${row["NK S2 2025"]}<br>

Ruas Jalan : ${row["Ruas Jalan"]}<br>

PPK : ${row["PPK"]}<br>

<br>

<a class="gmaps-btn"

target="_blank"

href="https://maps.google.com/?q=${lat},${lng}">

Open GMaps

</a>

`;


marker.bindPopup(popup);



cluster.addLayer(marker);



/* DROPDOWN */

var opt=document.createElement("option");

opt.value=i;

opt.text=row["Nama Jembatan"];

document.getElementById("pilih").appendChild(opt);



});



});



/* GO */

function zoomJembatan(){


var i=document.getElementById("pilih").value;


if(i==="")return;


var row=dataJembatan[i];


map.setView(

[row.Latitude,row.Longitude],

17

);


}



/* POSISI */

var markerSaya;


function posisiSaya(){


navigator.geolocation.getCurrentPosition(

function(pos){


var lat=pos.coords.latitude;

var lng=pos.coords.longitude;


if(markerSaya)

map.removeLayer(markerSaya);


markerSaya=L.marker([lat,lng])

.addTo(map);


map.setView([lat,lng],16);


});


}


</script>


</body>
</html>
