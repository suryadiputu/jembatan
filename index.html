<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Peta Aset Jembatan</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>

<style>

body{
margin:0;
font-family:Segoe UI,Arial;
background:#f5f7fa;
}

#map{
height:92vh;
}

/* TOP PANEL */

.topbar{

position:absolute;
top:10px;
left:50%;
transform:translateX(-50%);

background:white;

padding:10px 14px;

border-radius:10px;

box-shadow:0 3px 10px rgba(0,0,0,0.2);

display:flex;
gap:8px;

z-index:1000;
}

/* Dropdown */

.select2-container{
width:260px !important;
}

/* Buttons */

.btn{

border:none;
padding:8px 14px;
border-radius:6px;
font-weight:600;
cursor:pointer;
color:white;

}

.btn-go{
background:#0d6efd;
}

.btn-gps{
background:#198754;
}

.btn-filter{
background:#6c757d;
}

/* Tooltip */

.bridge-label{

font-size:12px;
font-weight:bold;

background:rgba(255,255,255,0.9);

padding:2px 6px;

border-radius:4px;

}

/* Popup */

.popup-content{

font-size:14px;
line-height:1.6;

}

/* Gmaps button */

.leaflet-popup-content .gmaps-btn{

display:inline-block;
padding:8px 14px;
background:#0d6efd;

color:white !important;

text-decoration:none;
border-radius:6px;
font-size:13px;
font-weight:600;

}


/* FILTER WINDOW */

.filter-popup{

position:absolute;

top:80px;
left:50%;
transform:translateX(-50%);

background:white;

padding:15px;

border-radius:10px;

box-shadow:0 3px 12px rgba(0,0,0,0.3);

display:none;

z-index:2000;

min-width:260px;

max-height:70vh;

overflow:auto;

}


/* MOBILE FIX */

@media (max-width:600px){

.topbar{

top:5px;

padding:6px 8px;

gap:6px;

border-radius:8px;

flex-direction:column;

width:210px;

}

.select2-container{

width:100% !important;

font-size:13px;

}

.btn{

padding:6px 8px;

font-size:12px;

border-radius:5px;

}

#map{

height:90vh;

}

/* Turunkan tombol zoom */

.leaflet-top.leaflet-left{

margin-top:60px;

}

}

</style>

</head>


<body>


<div class="topbar">

<select id="bridgeSelect"></select>

<button class="btn btn-go" onclick="focusBridge()">
GO
</button>

<button class="btn btn-gps" onclick="locateUser()">
Posisi Saat Ini
</button>

<button class="btn btn-filter" onclick="toggleFilter()">
Filter
</button>

</div>



<div id="map"></div>



<div class="filter-popup" id="filterBox">

<b>Filter PPK</b>
<div id="ppkList"></div>

<br>

<b>Filter NK S2 2025</b>
<div id="nkList"></div>

<br>

<button class="btn btn-go" onclick="applyFilter()">
Terapkan
</button>

<button class="btn btn-filter" onclick="resetFilter()">
Reset
</button>

</div>



<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>



<script>


// MAP

var map=L.map('map').setView([-8.6,115.2],10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{

attribution:'Â© OpenStreetMap'

}).addTo(map);



// CLUSTER

var cluster=L.markerClusterGroup({

maxClusterRadius:25

});

map.addLayer(cluster);



var bridgeMarkers={};

var rowsData=[];

var userMarker=null;



// ICON

var bridgeIcon=L.icon({

iconUrl:"bridge.png",

iconSize:[40,40],

iconAnchor:[20,40],

popupAnchor:[0,-35]

});



// LOAD EXCEL


fetch('Data Jembatan.xlsx')

.then(res=>res.arrayBuffer())

.then(data=>{

var workbook=XLSX.read(data);

var sheet=workbook.Sheets[workbook.SheetNames[0]];

var rows=XLSX.utils.sheet_to_json(sheet);

rowsData=rows;

loadBridges(rows);

});




// LOAD BRIDGES


function loadBridges(rows){


cluster.clearLayers();

$('#bridgeSelect').empty();


var ppkSet=new Set();

var nkSet=new Set();


rows.forEach(function(row){


var lat=parseFloat(row.Koordinat_Y);

var lng=parseFloat(row.Koordinat_X);


if(!lat||!lng)return;



ppkSet.add(row.PPK);

nkSet.add(row["NK S2 2025"]);



var marker=L.marker([lat,lng],{

icon:bridgeIcon

});


marker.bindPopup(generatePopup(row));


marker.bridgeName=row.Nama_Jembatan;



cluster.addLayer(marker);



bridgeMarkers[row.Nama_Jembatan]=marker;



$('#bridgeSelect').append(

new Option(row.Nama_Jembatan,row.Nama_Jembatan)

);


});


$('#bridgeSelect').select2({

placeholder:"Cari Nama Jembatan"

});



createCheckbox("ppkList",ppkSet);

createCheckbox("nkList",nkSet);

}




// POPUP


function generatePopup(row){


var gmaps=

`https://www.google.com/maps?q=${row.Koordinat_Y},${row.Koordinat_X}`;


return `

<div class="popup-content">


<b style="font-size:16px">

${row.Nama_Jembatan}

</b>

<br><br>


No. Jbt : ${row.No_Jbt}<br>

Tahun Bangun : ${row["Tahun Bangun"]}<br>

Panjang (m) : ${row["Panjang (m)"]}<br>

Lebar Jembatan (m) : ${row["Lebar Jembatan (m)"]}<br>

Lebar Lajur Lalin (m) : ${row["Lebar Lajur Lalin (m)"]}<br>

Jml Bentang : ${row["Jml Bentang"]}<br>

Tipe Bang. Atas : ${row["Tipe Bang. Atas"]}<br>

NK S2 2025 : ${row["NK S2 2025"]}<br>

Ruas Jalan : ${row["Ruas Jalan"]}<br>

PPK : ${row.PPK}<br><br>


<a href="${gmaps}"

target="_blank"

class="gmaps-btn">

Open GMaps

</a>


</div>

`;

}



// GO


function focusBridge(){

var name=$('#bridgeSelect').val();

var marker=bridgeMarkers[name];

if(marker){

map.setView(marker.getLatLng(),17);

marker.openPopup();

}

}



// GPS


function locateUser(){

map.locate({

setView:true,

maxZoom:17

});

}


map.on('locationfound',function(e){

if(userMarker)

map.removeLayer(userMarker);


userMarker=L.marker(e.latlng)

.addTo(map)

.bindPopup("Posisi Anda")

.openPopup();

});




// FILTER


function toggleFilter(){

var box=document.getElementById("filterBox");

box.style.display=

box.style.display=="block"?"none":"block";

}



function createCheckbox(div,set){

var html="";

set.forEach(function(val){

html+=`<label>

<input type="checkbox" value="${val}">

${val}

</label><br>`;

});

document.getElementById(div).innerHTML=html;

}



function applyFilter(){


var ppk=[];

var nk=[];


$("#ppkList input:checked").each(function(){

ppk.push(this.value);

});


$("#nkList input:checked").each(function(){

nk.push(this.value);

});


var filtered=rowsData.filter(function(r){

return

(ppk.length==0||ppk.includes(r.PPK))

&&

(nk.length==0||nk.includes(String(r["NK S2 2025"])));

});


loadBridges(filtered);


toggleFilter();

}




function resetFilter(){

loadBridges(rowsData);

toggleFilter();

}


</script>


</body>
</html>
