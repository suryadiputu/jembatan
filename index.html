<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Peta Jembatan</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>

body{
margin:0;
font-family:Arial;
}

#map{
height:65vh;
}

.controlBox{

position:absolute;
top:10px;
left:50%;
transform:translateX(-50%) scale(0.8);
transform-origin:top center;

background:white;
padding:10px;

border-radius:10px;
box-shadow:0px 0px 10px rgba(0,0,0,0.3);

z-index:1000;
text-align:center;
}

select,button{

padding:5px;
margin:3px;

font-size:14px;

}

#summary{

padding:10px;
background:#f5f5f5;

font-size:14px;

text-align:center;

border-top:1px solid #ccc;

}

</style>
</head>

<body>


<div class="controlBox">

<select id="filterNK">
<option value="">Semua NK</option>
<option value="1">NK 1</option>
<option value="2">NK 2</option>
<option value="3">NK 3</option>
<option value="4">NK 4</option>
</select>


<select id="filterKecamatan">
<option value="">Semua Kecamatan</option>
</select>


<br>

<button onclick="applyFilter()">Filter</button>

<button onclick="resetFilter()">Reset</button>

</div>



<div id="map"></div>


<div id="summary">

Memuat data...

</div>



<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>


<script>


var map = L.map('map').setView([-7.0,109.0],9);


L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
maxZoom:19
}).addTo(map);



var markers=[];

var allData=[];



fetch('jembatan.geojson')

.then(res=>res.json())

.then(data=>{

allData=data.features;

isiDropdown();

tampilkanData(allData);

});



function isiDropdown(){

var kecamatanSet=new Set();


allData.forEach(f=>{

kecamatanSet.add(f.properties.kecamatan);

});


var select=document.getElementById("filterKecamatan");


kecamatanSet.forEach(kec=>{

var opt=document.createElement("option");

opt.value=kec;

opt.text=kec;

select.appendChild(opt);

});


}



function tampilkanData(data){


markers.forEach(m=>map.removeLayer(m));

markers=[];



var totalJumlah=0;
var totalPanjang=0;

var nkJumlah={1:0,2:0,3:0,4:0};
var nkPanjang={1:0,2:0,3:0,4:0};



data.forEach(f=>{


var lat=f.geometry.coordinates[1];
var lon=f.geometry.coordinates[0];


var nama=f.properties.nama;
var nk=f.properties.nk;
var kec=f.properties.kecamatan;
var panjang=parseFloat(f.properties.panjang)||0;



var marker=L.marker([lat,lon])
.addTo(map)
.bindPopup(

"<b>"+nama+"</b><br>"+
"Kecamatan : "+kec+"<br>"+
"NK : "+nk+"<br>"+
"Panjang : "+panjang+" m"

);


markers.push(marker);



totalJumlah++;
totalPanjang+=panjang;

nkJumlah[nk]++;
nkPanjang[nk]+=panjang;


});


updateSummary(
totalJumlah,
totalPanjang,
nkJumlah,
nkPanjang
);


}



function updateSummary(jumlah,panjang,nkJumlah,nkPanjang){


document.getElementById("summary").innerHTML=

"Jumlah total jembatan : "+jumlah+" buah | Total panjang = "+panjang.toFixed(1)+" m <br><br>"+

"NK 1 : "+nkJumlah[1]+" buah | "+nkPanjang[1].toFixed(1)+" m<br>"+

"NK 2 : "+nkJumlah[2]+" buah | "+nkPanjang[2].toFixed(1)+" m<br>"+

"NK 3 : "+nkJumlah[3]+" buah | "+nkPanjang[3].toFixed(1)+" m<br>"+

"NK 4 : "+nkJumlah[4]+" buah | "+nkPanjang[4].toFixed(1)+" m";


}



function applyFilter(){


var nk=document.getElementById("filterNK").value;

var kec=document.getElementById("filterKecamatan").value;



var hasil=allData.filter(f=>{


var cocok=true;


if(nk!="")
cocok=cocok && f.properties.nk==nk;


if(kec!="")
cocok=cocok && f.properties.kecamatan==kec;


return cocok;

});


tampilkanData(hasil);


}



function resetFilter(){


document.getElementById("filterNK").value="";
document.getElementById("filterKecamatan").value="";


tampilkanData(allData);


}



</script>


</body>
</html>
